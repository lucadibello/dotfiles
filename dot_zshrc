# Path to oh-my-zsh installation
export ZSH="${HOME}/.oh-my-zsh"

# Prompt handled by Starship; leave Oh My Zsh theme empty
ZSH_THEME=""

# Core plugin set (vi mode + tmux requested)
plugins=(
  git
  vi-mode
  tmux
)

# Tmux plugin behavior
ZSH_TMUX_AUTOSTART="true"
ZSH_TMUX_AUTOCONNECT="true"

# Ensure editors and locale are set
if [[ -n "${SSH_CONNECTION:-}" ]]; then
  export EDITOR="vim"
else
  export EDITOR="nvim"
fi
export LANG="en_US.UTF-8"
export SHELL="$(command -v zsh || echo /bin/zsh)"

# Compiler defaults
export CC="clang"
export CXX="clang++"

# PATH adjustments (prepend Homebrew toolchains, append language managers)
prepend_path() {
  local dir="$1"
  if [[ -d "$dir" && ":$PATH:" != *":$dir:"* ]]; then
    PATH="$dir:$PATH"
  fi
}

append_path() {
  local dir="$1"
  if [[ -d "$dir" && ":$PATH:" != *":$dir:"* ]]; then
    PATH="$PATH:$dir"
  fi
}

prepend_path "/opt/homebrew/opt/openjdk/bin"
prepend_path "/opt/homebrew/opt/llvm/bin"

if command -v go >/dev/null 2>&1; then
  GO_PATH="$(go env GOPATH 2>/dev/null || true)"
  if [[ -n "${GO_PATH}" ]]; then
    append_path "${GO_PATH}/bin"
  fi
fi

export PATH

# Initialize Conda (if present)
if [[ -x "/opt/homebrew/Caskroom/miniconda/base/bin/conda" ]]; then
  eval "$(/opt/homebrew/Caskroom/miniconda/base/bin/conda shell.zsh hook 2>/dev/null)"
fi

# Load Oh My Zsh (warn if missing so install steps are obvious)
if [[ -f "${ZSH}/oh-my-zsh.sh" ]]; then
  source "${ZSH}/oh-my-zsh.sh"
else
  echo "Warning: oh-my-zsh not found at ${ZSH}; run scripts/install/post/oh-my-zsh.sh."
fi

# Shell integrations
alias mux="tmuxinator"

if command -v starship >/dev/null 2>&1; then
  eval "$(starship init zsh)"
fi

if command -v zoxide >/dev/null 2>&1; then
  eval "$(zoxide init zsh)"
fi

if command -v jenv >/dev/null 2>&1; then
  eval "$(jenv init - 2>/dev/null)"
fi

if command -v fzf >/dev/null 2>&1; then
  eval "$(fzf --zsh)"

  # change keybinding for cd widget
  bindkey '^E' fzf-cd-widget
fi

# Custom keybindings/aliases
KEYBINDINGS_FILE="${HOME}/.config/zsh/keybindings.sh"
if [[ -r "${KEYBINDINGS_FILE}" ]]; then
  source "${KEYBINDINGS_FILE}"
fi
unset KEYBINDINGS_FILE

# NOTE: loaded after zsh to override Ctrl+R keymap
if command -v atuin >/dev/null 2>&1; then
  eval "$(atuin init zsh 2>/dev/null)"
fi
